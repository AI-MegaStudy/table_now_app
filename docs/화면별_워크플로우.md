# Table Now 화면별 워크플로우

본 문서는 각 화면별 워크플로우를 Flowchart 심볼에 맞춰 문서화한 것입니다.  
이 문서를 기반으로 나중에 다이어그램(Flowchart)을 그릴 예정입니다.

**작성일**: 2026-01-20  
**기준**: `docs/앱_구조_및_화면_흐름.md`

---

## Flowchart 심볼 설명

- **[Start/End]**: 타원형 - 프로세스 시작/종료
- **[Process]**: 직사각형 - 처리/작업 수행
- **[Decision]**: 다이아몬드 - 조건 판단/분기
- **[Input/Output]**: 평행사변형 - 데이터 입력/출력
- **[Database]**: 원통형 - 데이터베이스 테이블 조회/저장/수정/삭제
- **[Preparation]**: 육각형 - 준비/초기화 작업
- **[Connector]**: 원형 - 연결점 (같은 페이지 내 다른 흐름으로 이동)
- **[→]**: 화살표 - 흐름 방향

---

## 1. 초기화면

**[Database]** `customer` (자동 로그인 정보 확인)

**[Start]** 앱 시작

**[Process]** 앱 초기화 작업 수행
- Firebase 초기화
- FCM 초기화
- 로컬 저장소 초기화
- 권한 확인

**[Decision]** 자동 로그인 활성화 여부 확인
- **Yes** → **[Process]** 저장된 로그인 정보 확인
  - **[Decision]** 로그인 정보 유효 여부
    - **Yes** → **[Process]** 자동 로그인 처리 → **[→]** 지역 선택 화면
    - **No** → **[→]** 로그인 화면
- **No** → **[→]** 로그인 화면

**[End]** 화면 전환 완료

---

## 2. 로그인 화면

**[Database]** `customer` (로그인 인증, 소셜 로그인, 계정 통합)

**[Start]** 로그인 화면 진입

**[Process]** 화면 초기화
- 이메일/비밀번호 입력 필드 표시
- 소셜 로그인 버튼 표시

**[Decision]** 사용자 액션 선택
- **일반 로그인** → **[Process]** 이메일/비밀번호 입력
  - **[Decision]** 폼 검증 통과 여부
    - **No** → **[Output]** 에러 메시지 표시 → **[Connector]** 다시 입력
    - **Yes** → **[Process]** 로그인 API 호출
      - **[Decision]** 로그인 성공 여부
        - **Yes** → **[Process]** 사용자 정보 저장 → **[→]** 지역 선택 화면
        - **No** → **[Output]** 에러 메시지 표시 → **[Connector]** 다시 입력
- **소셜 로그인 (Google)** → **[Process]** Google Sign-In 처리
  - **[Decision]** 로그인 성공 여부
    - **Yes** → **[Process]** 백엔드 소셜 로그인 API 호출
      - **[Decision]** 계정 통합 필요 여부 (NeedLink 응답)
        - **Yes** → **[Output]** 계정 통합 확인 다이얼로그 표시
          - **[Decision]** 통합 동의 여부
            - **Yes** → **[Process]** 계정 통합 API 호출 → **[Process]** 사용자 정보 저장 → **[→]** 지역 선택 화면
            - **No** → **[Output]** 에러 메시지 표시 → **[Connector]** 다시 시도
        - **No** → **[Process]** 사용자 정보 저장 → **[→]** 지역 선택 화면
    - **No** → **[Output]** 에러 메시지 표시 → **[Connector]** 다시 시도
- **회원가입** → **[→]** 회원가입 화면

**[End]** 화면 전환 완료

---

## 3. 회원가입 화면

**[Database]** `customer` (신규 사용자 등록)

**[Start]** 회원가입 화면 진입

**[Process]** 화면 초기화
- 회원가입 폼 표시 (이름, 전화번호, 이메일, 비밀번호, 비밀번호 확인)

**[Process]** 사용자 정보 입력
- 이름 입력
- 전화번호 입력 (선택사항)
- 이메일 입력
- 비밀번호 입력
- 비밀번호 확인 입력

**[Decision]** 폼 검증 통과 여부
- **No** → **[Output]** 검증 에러 메시지 표시 → **[Connector]** 다시 입력
- **Yes** → **[Process]** 회원가입 API 호출
  - **[Decision]** 회원가입 성공 여부
    - **Yes** → **[Output]** 성공 다이얼로그 표시 → **[→]** 로그인 화면
    - **No** → **[Output]** 에러 메시지 표시 → **[Connector]** 다시 입력

**[End]** 화면 전환 완료

---

## 4. 지역 선택 화면

**[Database]** `store` (지역별 식당 목록 조회)

**[Start]** 지역 선택 화면 진입

**[Process]** 화면 초기화
- 지역 목록 로드

**[Process]** 지역 목록 표시

**[Process]** 사용자가 지역 선택

**[Decision]** 지역 선택 완료 여부
- **Yes** → **[Process]** 선택된 지역 정보 저장 → **[→]** 지도 화면
- **No** → **[Connector]** 계속 선택

**[End]** 화면 전환 완료

---

## 5. 지도 화면 1

**[Database]** `store` (식당 위치 정보: 위도, 경도, 이미지 URL 등)

**[Start]** 지도 화면 진입

**[Process]** 화면 초기화
- Google Maps 초기화
- 현재 위치 권한 확인

**[Process]** 식당 목록 API 호출

**[Process]** 지도에 식당 마커 표시

**[Process]** 사용자가 식당 마커 클릭 또는 식당 선택

**[Decision]** 식당 선택 완료 여부
- **Yes** → **[Process]** 선택된 식당 정보 저장 → **[→]** 예약화면 또는 메뉴화면
- **No** → **[Connector]** 계속 탐색

**[End]** 화면 전환 완료

---

## 6. 지도 화면 2

**[Database]** `store` (식당 상세 정보, 이미지 URL)

**[Start]** 지도 화면 2 진입 (상세 정보 표시)

**[Process]** 선택된 식당 상세 정보 표시
- 식당 정보
- 이미지
- 리뷰 등

**[Decision]** 사용자 액션 선택
- **예약하기** → **[→]** 예약화면
- **메뉴 보기** → **[→]** 메뉴화면 1
- **뒤로가기** → **[→]** 지도 화면 1

**[End]** 화면 전환 완료

---

## 7. 예약화면

**[Database]** 
- `store` (식당 정보)
- `store_table` (테이블 정보 및 사용 가능 여부)
- `reserve` (예약 정보 저장)
- OpenWeatherMap API (날씨 정보 실시간 조회)

**[Start]** 예약화면 진입

**[Process]** 화면 초기화
- 선택된 식당 정보 표시
- 날씨 정보 조회 및 표시

**[Process]** 예약 정보 입력
- 날짜 선택
- 시간 선택
- 인원 수 선택

**[Decision]** 예약 정보 입력 완료 여부
- **No** → **[Output]** 필수 항목 입력 안내 → **[Connector]** 계속 입력
- **Yes** → **[Process]** 예약 가능 여부 확인 API 호출
  - **[Decision]** 예약 가능 여부
    - **Yes** → **[→]** 테이블 배치화면
    - **No** → **[Output]** 예약 불가 메시지 표시 → **[Connector]** 날짜/시간 변경

**[End]** 화면 전환 완료

---

## 8. 테이블 배치화면

**[Database]** 
- `store_table` (테이블 배치 정보 `store_placement`, 테이블 사용 가능 여부 `store_table_inuse`)
- `store` (테이블 배치도 정보 `store_placement`)

**[Start]** 테이블 배치화면 진입

**[Process]** 화면 초기화
- 선택된 식당의 테이블 목록 조회
- 테이블 배치도 표시

**[Process]** 테이블 배치도 렌더링
- 테이블 위치 표시
- 사용 가능/불가능 상태 표시

**[Process]** 사용자가 테이블 선택

**[Decision]** 선택한 테이블 사용 가능 여부
- **Yes** → **[Process]** 선택된 테이블 정보 저장 → **[→]** 메뉴화면 1 또는 예약 완료 화면
- **No** → **[Output]** 테이블 사용 불가 메시지 표시 → **[Connector]** 다른 테이블 선택

**[End]** 화면 전환 완료

---

## 9. 메뉴화면 1

**[Database]** `menu` (메뉴 목록 및 기본 정보)

**[Start]** 메뉴화면 1 진입

**[Process]** 화면 초기화
- 선택된 식당의 메뉴 목록 조회 API 호출

**[Process]** 메뉴 목록 표시
- 메뉴 카테고리별 분류
- 메뉴 기본 정보 표시 (이름, 가격, 이미지 등)

**[Process]** 사용자가 메뉴 선택

**[Decision]** 메뉴 선택 완료 여부
- **Yes** → **[Process]** 선택된 메뉴 정보 저장 → **[→]** 메뉴화면 2
- **No** → **[Connector]** 계속 탐색

**[End]** 화면 전환 완료

---

## 10. 메뉴화면 2

**[Database]** 
- `menu` (메뉴 상세 정보)
- `option` (추가 메뉴 옵션 목록)

**[Start]** 메뉴화면 2 진입

**[Process]** 화면 초기화
- 선택된 메뉴 상세 정보 조회 API 호출
- 옵션 목록 조회 API 호출

**[Process]** 메뉴 상세 정보 표시
- 메뉴 이미지
- 메뉴 설명
- 가격 정보

**[Process]** 옵션 목록 표시

**[Process]** 사용자가 옵션 선택

**[Decision]** 옵션 선택 완료 여부
- **Yes** → **[Process]** 선택된 옵션 정보 저장 → **[→]** 메뉴 화면 3
- **No** → **[Connector]** 계속 선택

**[End]** 화면 전환 완료

---

## 11. 메뉴 화면 3

**[Database]** 
- `menu` (선택된 메뉴 정보)
- `option` (선택된 옵션 정보)
- (장바구니는 메모리/로컬 상태로 관리)

**[Start]** 메뉴 화면 3 진입

**[Process]** 화면 초기화
- 장바구니 정보 표시
- 선택된 메뉴 및 옵션 목록 표시
- 총 금액 계산

**[Process]** 장바구니 관리
- 메뉴 수량 조정
- 메뉴 삭제
- 옵션 수정

**[Decision]** 사용자 액션 선택
- **메뉴 추가** → **[→]** 메뉴화면 1
- **주문하기** → **[Decision]** 장바구니 비어있음 여부
    - **Yes** → **[Output]** 장바구니 비어있음 메시지 → **[Connector]** 메뉴 추가
    - **No** → **[Process]** 주문 정보 저장 → **[→]** 예약 완료 화면
- **수정** → **[→]** 메뉴화면 2

**[End]** 화면 전환 완료

---

## 12. 예약 완료 화면

**[Database]** 
- `store` (식당 정보)
- `store_table` (테이블 정보)
- `menu` (선택된 메뉴 정보)
- OpenWeatherMap API (날씨 정보 실시간 조회)
- `option` (선택된 옵션 정보)
- `reserve` (예약 정보 저장 준비)

**[Start]** 예약 완료 화면 진입

**[Process]** 화면 초기화
- 예약 정보 요약 표시
  - 식당 정보
  - 날짜/시간
  - 인원 수
  - 테이블 정보
  - 선택한 메뉴 및 옵션
  - 총 금액
- 날씨 정보 표시

**[Process]** 예약 정보 최종 확인

**[Decision]** 사용자 확인 여부
- **확인** → **[→]** 결제 화면
- **수정** → **[Decision]** 수정할 항목 선택
    - **예약 정보** → **[→]** 예약화면
    - **테이블** → **[→]** 테이블 배치화면
    - **메뉴** → **[→]** 메뉴화면 1

**[End]** 화면 전환 완료

---

## 13. 예약 확인 화면

**[Database]** 
- `reserve` (예약 정보 조회)
- `pay` (결제 내역 조회)
- `menu` (주문한 메뉴 정보)
- OpenWeatherMap API (날씨 정보 실시간 조회)
- `option` (주문한 옵션 정보)

**[Start]** 예약 확인 화면 진입 (결제 완료 후)

**[Process]** 화면 초기화
- 예약 정보 조회 API 호출

**[Process]** 예약 정보 표시
- 예약 번호
- 예약 상세 정보
- 결제 내역
- 예약 상태

**[Decision]** 사용자 액션 선택
- **홈으로** → **[→]** 지역 선택 화면 또는 지도 화면
- **예약 내역 보기** → **[→]** 예약 목록 화면 (미구현)

**[End]** 화면 전환 완료

---

## 14. 결제 화면

**[Database]** 
- `reserve` (예약 정보 업데이트: `payment_key`, `payment_status`)
- `pay` (결제 내역 저장)
- `menu` (주문한 메뉴 정보)
- `option` (주문한 옵션 정보)

**[Start]** 결제 화면 진입

**[Process]** 화면 초기화
- 결제 정보 표시
  - 총 금액
  - 주문 내역 요약

**[Process]** 결제 정보 입력
- 결제 수단 선택
- 결제 정보 입력 (카드 정보 등)

**[Decision]** 결제 수단 선택
- **Toss Payment** → **[Process]** Toss Payment 연동
  - **[Process]** 결제 API 호출
    - **[Decision]** 결제 성공 여부
      - **Yes** → **[Process]** 결제 내역 저장 → **[Process]** 예약 확정 처리 → **[→]** 예약 확인 화면
      - **No** → **[Output]** 결제 실패 메시지 표시 → **[Connector]** 다시 시도
- **기타 결제 수단** → **[Process]** 해당 결제 수단 처리

**[End]** 화면 전환 완료

---

## 15. 회원정보 drawer

**[Database]** `customer` (사용자 정보 조회)

**[Start]** 회원정보 drawer 열기

**[Process]** 화면 초기화
- 현재 로그인한 사용자 정보 조회
- 사용자 정보 표시 (이름, 이메일, 전화번호 등)

**[Process]** 사용자 정보 표시

**[Decision]** 사용자 액션 선택
- **회원 정보 수정** → **[→]** 회원 정보 수정 화면
- **로그아웃** → **[Decision]** 로그아웃 확인
    - **Yes** → **[Process]** 로그인 정보 삭제 → **[→]** 로그인 화면
    - **No** → **[Connector]** drawer 유지
- **닫기** → **[End]** drawer 닫기

**[End]** drawer 닫기 완료

---

## 16. 회원 정보 수정 화면

**[Database]** `customer` (사용자 정보 조회 및 수정)

**[Start]** 회원 정보 수정 화면 진입

**[Process]** 화면 초기화
- 현재 사용자 정보 로드
- 사용자 정보 입력 필드에 기존 값 표시

**[Process]** 사용자 정보 표시
- 이름 (수정 가능)
- 이메일 (읽기 전용)
- 전화번호 (수정 가능)

**[Decision]** 사용자 계정 타입 확인
- **구글 로그인 사용자** → **[Process]** 정보 수정
  - **[Process]** 이름/전화번호 수정
  - **[Decision]** 폼 검증 통과 여부
    - **No** → **[Output]** 검증 에러 메시지 표시 → **[Connector]** 다시 입력
    - **Yes** → **[Process]** 회원 정보 수정 API 호출
      - **[Decision]** 수정 성공 여부
        - **Yes** → **[Output]** 성공 메시지 표시 → **[Process]** 사용자 정보 업데이트 → **[→]** 이전 화면
        - **No** → **[Output]** 에러 메시지 표시 → **[Connector]** 다시 시도
- **일반 사용자 (로컬 계정)** → **[Process]** 정보 수정
  - **[Process]** 이름/전화번호 수정
  - **[Decision]** 폼 검증 통과 여부
    - **No** → **[Output]** 검증 에러 메시지 표시 → **[Connector]** 다시 입력
    - **Yes** → **[Process]** 회원 정보 수정 API 호출
      - **[Decision]** 수정 성공 여부
        - **Yes** → **[Output]** 성공 메시지 표시 → **[Process]** 사용자 정보 업데이트
        - **No** → **[Output]** 에러 메시지 표시 → **[Connector]** 다시 시도
  - **[Decision]** 비밀번호 변경 버튼 클릭 여부
    - **Yes** → **[→]** 비밀번호 변경 화면
    - **No** → **[→]** 이전 화면

**[End]** 화면 전환 완료

---

## 17. 비밀번호 변경 화면 (일반 사용자 전용)

**[Database]** 
- `customer` (사용자 정보 확인, 비밀번호 변경)
- `password_reset_auth` (인증 코드 요청, 검증, 인증 토큰 관리)

**[Start]** 비밀번호 변경 화면 진입

**[Process]** 화면 초기화
- 현재 단계: 1단계 (인증 코드 요청/입력)

### 1단계: 인증 코드 요청 및 입력

**[Process]** 인증 코드 요청 버튼 표시

**[Decision]** 인증 코드 요청 버튼 클릭 여부
- **Yes** → **[Process]** 인증 코드 요청 API 호출
  - **[Decision]** 요청 성공 여부
    - **Yes** → **[Output]** 성공 메시지 표시 (이메일로 인증 코드 발송됨)
    - **No** → **[Output]** 에러 메시지 표시 → **[Connector]** 다시 시도
- **No** → **[Connector]** 대기

**[Process]** 인증 코드 입력 필드 표시
- 만료 시간 표시

**[Process]** 사용자가 인증 코드 입력

**[Decision]** 인증 코드 검증 버튼 클릭 여부
- **Yes** → **[Decision]** 인증 코드 형식 검증 (6자리 숫자)
    - **No** → **[Output]** 형식 에러 메시지 표시 → **[Connector]** 다시 입력
    - **Yes** → **[Process]** 인증 코드 검증 API 호출
      - **[Decision]** 검증 성공 여부
        - **Yes** → **[Process]** 인증 토큰 저장 → **[Process]** 2단계로 이동
        - **No** → **[Output]** 검증 실패 메시지 표시 → **[Connector]** 다시 입력
- **No** → **[Connector]** 대기

### 2단계: 새 비밀번호 입력

**[Process]** 화면 초기화 (2단계)
- 새 비밀번호 입력 필드 표시
- 비밀번호 확인 입력 필드 표시

**[Process]** 사용자가 새 비밀번호 입력
- 새 비밀번호 입력
- 비밀번호 확인 입력

**[Decision]** 비밀번호 변경 버튼 클릭 여부
- **Yes** → **[Decision]** 폼 검증 통과 여부
    - **No** → **[Output]** 검증 에러 메시지 표시 → **[Connector]** 다시 입력
    - **Yes** → **[Decision]** 비밀번호 일치 여부
        - **No** → **[Output]** 비밀번호 불일치 메시지 표시 → **[Connector]** 다시 입력
        - **Yes** → **[Process]** 비밀번호 변경 API 호출
          - **[Decision]** 변경 성공 여부
            - **Yes** → **[Output]** 성공 다이얼로그 표시 → **[Process]** 이전 화면으로 반환값 전달 → **[→]** 회원 정보 수정 화면
            - **No** → **[Output]** 에러 메시지 표시 → **[Connector]** 다시 시도
- **No** → **[Connector]** 대기

**[End]** 화면 전환 완료

---

## 변경 이력

- **2026-01-20**: 초기 문서 작성
  - Flowchart 심볼 설명 추가
  - 각 화면별 워크플로우 작성 (1~17번)
  - Flowchart 다이어그램 작성을 위한 텍스트 기반 워크플로우 문서화

- **2026-01-20**: 데이터베이스 테이블 정보 추가
  - 각 화면별 사용 테이블 명시
  - `docs/테이블_스펙시트_v_5_erd_02_반영.md` 기준으로 테이블 정보 추가
  - 데이터베이스 테이블을 원통형 심볼 **[Database]**로 표시
